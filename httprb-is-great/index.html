<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Http.rb is Great | Janko Marohnić</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico?v=1" sizes="any">
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Http.rb is Great" />
<meta name="author" content="Janko Marohnić" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Ruby ecosystem has many HTTP clients gems to choose from. Some are built on libcurl (Typhoeus, Curb, Patron), some on Ruby’s Net::HTTP (RestClient, HTTParty, Nestful), some in pure Ruby (HTTPClient, Excon, http.rb), and some are wrappers around existing libraries (Faraday, HTTPI)." />
<meta property="og:description" content="The Ruby ecosystem has many HTTP clients gems to choose from. Some are built on libcurl (Typhoeus, Curb, Patron), some on Ruby’s Net::HTTP (RestClient, HTTParty, Nestful), some in pure Ruby (HTTPClient, Excon, http.rb), and some are wrappers around existing libraries (Faraday, HTTPI)." />
<link rel="canonical" href="https://janko.io/httprb-is-great/" />
<meta property="og:url" content="https://janko.io/httprb-is-great/" />
<meta property="og:site_name" content="Janko Marohnić" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-02T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Http.rb is Great" />
<meta name="twitter:site" content="@jankomarohnic" />
<meta name="twitter:creator" content="@jankomarohnic" />
<meta property="article:publisher" content="https://www.facebook.com/janko.marohnic/" />
<script type="application/ld+json">
{"datePublished":"2018-06-02T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://janko.io/httprb-is-great/"},"author":{"@type":"Person","name":"Janko Marohnić"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://janko.io/images/logo.png"},"name":"Janko Marohnić"},"@type":"BlogPosting","description":"The Ruby ecosystem has many HTTP clients gems to choose from. Some are built on libcurl (Typhoeus, Curb, Patron), some on Ruby’s Net::HTTP (RestClient, HTTParty, Nestful), some in pure Ruby (HTTPClient, Excon, http.rb), and some are wrappers around existing libraries (Faraday, HTTPI).","url":"https://janko.io/httprb-is-great/","headline":"Http.rb is Great","dateModified":"2018-06-02T00:00:00+02:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link type="application/atom+xml" rel="alternate" href="https://janko.io/feed.xml" title="Janko Marohnić" />
    <link rel="stylesheet" href="/css/bundle.css">
    
      <script src="https://cdn.usefathom.com/script.js" data-site="EKJCVCTX" defer></script>
    
    <script>
      function updateTheme() {
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
      }
      updateTheme()
    </script>
  </head>

  <body class="text-xl text-slate-700 dark:bg-slate-900 dark:text-slate-400 min-h-screen flex flex-col">
    <header class="py-3 px-4 bg-gray-100 border-b dark:bg-slate-800/70 dark:border-slate-700">
      <div class="max-w-screen-sm md:max-w-screen-md mx-auto flex items-center">
        <div class="flex-1">
          <a class="text-lg xs:text-xl sm:text-2xl md:text-3xl font-semibold tracking-wide text-pink-700/80 hover:text-pink-800 dark:text-pink-500 dark:hover:text-pink-400 transition" href="/">
            Janko Marohnić
          </a>
        </div>

        <a class="flex items-center space-x-2 justify-self-center" href="/">
          <svg class="h-7 w-7 rounded lg:h-10 lg:w-10 lg:rounded-lg" role="img" aria-labelledby="logo-title" viewbox="0 0 64 64">
            <title id="logo-title">logo</title>
            <clippath id="topLeft"><path d="M64,0.025l-64,64l0,-64l64,0Z"></path></clippath>
            <clippath id="bottomRight"><path d="M0,64l64,-64l0,64l-64,0Z"></path></clippath>
            <g clip-path="url(#topLeft)"><rect class="fill-current text-pink-500" x="0.025" y="0.025" width="64" height="64"></rect><path class="fill-current text-white" d="M31.989,22.518c-0.031,-4.597 -0.902,-8.134 -2.612,-10.613c-1.71,-2.478 -4.165,-3.717 -7.365,-3.717c-3.2,0 -5.655,1.251 -7.365,3.753c-1.71,2.502 -2.565,6.114 -2.565,10.836l0,6.471c0.063,4.549 0.953,8.043 2.671,10.483c1.718,2.439 4.153,3.659 7.306,3.659c3.185,0 5.636,-1.255 7.354,-3.765c1.717,-2.51 2.576,-6.134 2.576,-10.871l0,-6.236Zm-6.682,7.647c-0.032,2.605 -0.31,4.538 -0.836,5.801c-0.525,1.263 -1.329,1.894 -2.412,1.894c-1.145,0 -1.988,-0.675 -2.529,-2.024c-0.542,-1.349 -0.812,-3.404 -0.812,-6.165l0,-8.541c0.078,-4.942 1.176,-7.413 3.294,-7.413c1.13,0 1.961,0.675 2.494,2.024c0.534,1.349 0.801,3.373 0.801,6.071l0,8.353Z"></path></g><g clip-path="url(#bottomRight)"><rect class="fill-current text-pink-700" x="0.025" y="0.025" width="64" height="64"></rect><path class="fill-current text-white" d="M44.945,55.261l-6.553,0l0,-25.659l-6.392,2.469l0,-5.446l12.253,-5.007l0.692,0l0,33.643Z"></path>&lt;
          </g></svg>
        </a>

        <span class="flex-1 flex space-x-2 justify-end">
          <button type="button" class="theme-reset rounded-full bg-sky-200 dark:bg-sky-900 px-2.5 py-1 text-xs font-medium text-sky-700 dark:text-white shadow-sm dark:hover:bg-sky-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-200">Reset to OS</button>

          <button type="button" class="theme-toggle bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transitikon-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-pink-700 focus:ring-offset-2 dark:focus:ring-pink-500 dark:focus:ring-offset-slate-900" role="switch" aria-checked="false">
            <span class="sr-only">Use setting</span>
            <span class="theme-toggle-ring translate-x-0 pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out">
              <span class="theme-toggle-light opacity-100 duration-200 ease-in absolute inset-0 flex h-full w-full items-center justify-center transition-opacity" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4kkkkkkk h-4">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"></path>
                </svg>
              </span>
              <span class="theme-toggle-dark opacity-0 duration-100 ease-out absolute inset-0 flex h-full w-full items-center justify-center transition-opacity" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-pink-500">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"></path>
                </svg>
              </span>
            </span>
          </button>
        </span>
      </div>
    </header>

    <div class="flex-1 my-2 sm:my-4 mx-4">
      <main class="max-w-screen-sm md:max-w-screen-md mx-auto">
        <article class="mt-6">
  <time datetime="2018-06-02" class="flex items-center text-slate-400 text-sm md:text-base">
    <span class="h-4 md:h-5 w-0.5 rounded-full bg-slate-200 dark:bg-slate-500"></span>
    <span class="ml-3">June 02, 2018</span>
  </time>

  <h1 class="mt-5 sm:mt-6 text-3xl sm:text-4xl lg:text-5xl font-semibold text-slate-900 tracking-tight dark:text-slate-100">Http.rb is Great</h1>

  <div class="mt-6 sm:mt-8 markdown">
    <p>The Ruby ecosystem has many HTTP clients gems to choose from. Some are built on
<a href="https://curl.haxx.se/libcurl/">libcurl</a> (<a href="https://github.com/typhoeus/typhoeus">Typhoeus</a>, <a href="https://github.com/taf2/curb">Curb</a>, <a href="https://github.com/toland/patron">Patron</a>), some on Ruby’s <a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/net/http/rdoc/Net/HTTP.html">Net::HTTP</a>
(<a href="http://github.com/rest-client/rest-client">RestClient</a>, <a href="https://github.com/jnunemaker/httparty">HTTParty</a>, <a href="https://github.com/maccman/nestful">Nestful</a>), some in pure Ruby (<a href="https://github.com/nahi/httpclient">HTTPClient</a>,
<a href="https://github.com/excon/excon">Excon</a>, <a href="https://github.com/httprb/http">http.rb</a>), and some are wrappers around existing libraries
(<a href="https://github.com/lostisland/faraday">Faraday</a>, <a href="https://github.com/savonrb/httpi">HTTPI</a>).</p>

<div class="media">
  <img alt="Taxonomy of Ruby HTTP client libraries" src="/images/ruby-http-client-taxonomy.png">
</div>

<p>Over the years I’ve had the opportunity to try out most of these libraries, but
ever since I discovered <strong><a href="https://github.com/httprb/http">http.rb</a></strong> a year ago, it’s been my favourite
HTTP client library. So, in this post I would like to talk about the features
that make http.rb stand out for me.</p>

<h2 id="nethttp">Net::HTTP</h2>

<p>Before we start, I would like to say a few words about Net::HTTP. Net::HTTP is
the HTTP client that comes with the Ruby standard library, and it’s used in
many places. People often reach for it when they want something simple, or they
use it indirectly through gems like RestClient and HTTParty.</p>

<p>However, whenever I used Net::HTTP, I always had a bad time. Some of the reasons
were</p>

<ul>
  <li>inconsistent and overly verbose API that’s tough to remember</li>
  <li>poorly designed internals making the code difficult to read</li>
  <li>having to handle low-level system call exceptions</li>
</ul>

<p>To illustrate, in my previous job we used Net::HTTP for notifying webhooks, and
this is the code that we ended up with:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">post_payload</span><span class="p">(</span><span class="n">callback_url</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">callback_url</span><span class="p">)</span>

  <span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">open_timeout: </span><span class="mi">15</span><span class="p">,</span> <span class="ss">read_timeout: </span><span class="mi">30</span> <span class="p">}</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="ss">use_ssl: </span><span class="kp">true</span><span class="p">)</span> <span class="k">if</span> <span class="n">uri</span><span class="p">.</span><span class="nf">scheme</span> <span class="o">==</span> <span class="s2">"https"</span>

  <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
    <span class="n">post</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">post</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/json"</span>

    <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">SocketError</span><span class="p">,</span>
       <span class="no">EOFError</span><span class="p">,</span>
       <span class="no">IOError</span><span class="p">,</span>
       <span class="no">SystemCallError</span><span class="p">,</span> <span class="c1"># superclass for all Errno::* exceptions</span>
       <span class="no">Timeout</span><span class="o">::</span><span class="no">Error</span><span class="p">,</span> <span class="c1"># superclass for Net::ReadTimeout and Net::OpenTimeout</span>
       <span class="no">Net</span><span class="o">::</span><span class="no">HTTPBadResponse</span><span class="p">,</span>
       <span class="no">Net</span><span class="o">::</span><span class="no">HTTPHeaderSyntaxError</span><span class="p">,</span>
       <span class="no">Net</span><span class="o">::</span><span class="no">ProtocolError</span><span class="p">,</span>
       <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">SSLError</span>
  <span class="c1"># handle exception</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The wish to make performing tasks like these easier was probably what motivated
people to build HTTP client gems on top of Net::HTTP (RestClient, HTTParty,
Nestful etc). They wanted to improve the API, but didn’t want to reimplement
the HTTP protocol. However, I found the Net::HTTP codebase to be very
convoluted, and always felt frustrated whenever I needed to read it. So, I
don’t think that building on top of Net::HTTP is a good design decision,
because Net::HTTP is not a clean implementation of the HTTP protocol to begin
with.</p>

<p>When creating http.rb, Tony Arcieri decided to rebuild the HTTP protocol
natively in Ruby (and also created the <a href="https://github.com/socketry/socketry">Socketry</a> gem to make working with
TCP/UDP sockets easier). This allowed http.rb to have a fresh start, without
the Net::HTTP baggage.</p>

<blockquote>
  <p>http.rb was born out of rage from using Net::HTTP</p>

  <p>— Tony Arcieri, creator of http.rb</p>
</blockquote>

<h2 id="refreshing-api">Refreshing API</h2>

<p>One of the important goals of http.rb was to make the API easy to use. Let’s
rewrite the previous Net::HTTP example of POSTing a JSON payload to an URL,
this time using http.rb.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">post_payload</span><span class="p">(</span><span class="n">callback_url</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="n">http</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">timeout</span><span class="p">(</span><span class="ss">connect: </span><span class="mi">15</span><span class="p">,</span> <span class="ss">read: </span><span class="mi">30</span><span class="p">)</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">callback_url</span><span class="p">,</span> <span class="ss">json: </span><span class="n">payload</span><span class="p">)</span>
<span class="k">rescue</span> <span class="no">HTTP</span><span class="o">::</span><span class="no">Error</span>
  <span class="c1"># handle exception</span>
<span class="k">end</span>
</code></pre></div></div>

<p><em>Much</em> easier! Unlike Net::HTTP, http.rb wraps all low-level exceptions into a
nice exception hierarchy that’s easy to handle:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">HTTP::Error</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">HTTP::ConnectionError</code></li>
      <li><code class="language-plaintext highlighter-rouge">HTTP::RequestError</code></li>
      <li><code class="language-plaintext highlighter-rouge">HTTP::ResponseError</code></li>
      <li><code class="language-plaintext highlighter-rouge">HTTP::TimeoutError</code></li>
      <li><code class="language-plaintext highlighter-rouge">HTTP::HeaderError</code></li>
    </ul>
  </li>
</ul>

<p>Here is a more comprehensive example of interaction with http.rb objects:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">)</span>
<span class="n">response</span> <span class="c1"># =&gt; #&lt;HTTP::Response/1.1 200 OK ...&gt;</span>

<span class="n">response</span><span class="p">.</span><span class="nf">status</span>          <span class="c1"># =&gt; #&lt;HTTP::Response::Status 200 OK&gt;</span>
<span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">.</span><span class="nf">code</span>     <span class="c1"># =&gt; 200</span>
<span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">.</span><span class="nf">ok?</span>      <span class="c1"># =&gt; true (200)</span>
<span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">.</span><span class="nf">success?</span> <span class="c1"># =&gt; true (200..299)</span>

<span class="n">response</span><span class="p">.</span><span class="nf">headers</span>         <span class="c1"># =&gt; #&lt;HTTP::Headers {…}&gt;</span>
<span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">.</span><span class="nf">to_h</span>    <span class="c1"># =&gt; { "Content-Type"=&gt;"text/html", ... }</span>

<span class="n">response</span><span class="p">.</span><span class="nf">body</span>            <span class="c1"># =&gt; #&lt;HTTP::Response::Body&gt;</span>
<span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">to_s</span>       <span class="c1"># =&gt; "&lt;!doctype html&gt;..."</span>
</code></pre></div></div>

<p>Where http.rb really shines is its chainable API for building request options.
You can use it to build an HTTP client with default request options, and then
make subsequent requests with it.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Build an HTTP::Client with default request options</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">HTTP</span>
  <span class="p">.</span><span class="nf">headers</span><span class="p">(</span><span class="s2">"User-Agent"</span> <span class="o">=&gt;</span> <span class="s2">"MyApp/1.0.0"</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">accept</span><span class="p">(</span><span class="ss">:json</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span><span class="ss">user: </span><span class="s2">"janko"</span><span class="p">,</span> <span class="ss">pass: </span><span class="s2">"secret"</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">via</span><span class="p">(</span><span class="s2">"https://proxy.com"</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">follow</span><span class="p">(</span><span class="ss">max_hops: </span><span class="mi">2</span><span class="p">)</span>

<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://blog.com/posts"</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://blog/com/posts/1"</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://blog/com/posts/1/comments"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="streaming">Streaming</h2>

<p>One of the features of http.rb that I like very much is the support for
streaming requests and responses. This is really useful when you need to
transfer large amounts of data over-the-wire which you don’t want to load into
memory all at once (think uploading and downloading large files).</p>

<h3 id="uploads">Uploads</h3>

<p>There are two ways you can stream content into the request body with http.rb.
One is providing an <a href="https://ruby-doc.org/core-2.5.1/Enumerable.html">Enumerable</a> object, where you can have <code class="language-plaintext highlighter-rouge">#each</code> lazily
generate chunks of content for the request body. The easiest way is to create
an <a href="https://ruby-doc.org/core-2.5.1/Enumerator.html">Enumerator</a> object.</p>

<p>Another way is providing an <a href="https://ruby-doc.org/core-2.5.1/IO.html">IO</a>-like object that implements <a href="http://ruby-doc.org/core-2.5.0/IO.html#method-i-read"><code class="language-plaintext highlighter-rouge">IO#read</code></a>. In
this case http.rb will read the IO content in small chunks and write them to
the request body. Notice that the object doesn’t have to be an actual <code class="language-plaintext highlighter-rouge">File</code>
instance, which is very convenient in contexts such as <a href="https://github.com/shrinerb/shrine">Shrine</a>, where the
“file” to be uploaded can be a <code class="language-plaintext highlighter-rouge">File</code>, <code class="language-plaintext highlighter-rouge">Tempfile</code>, <code class="language-plaintext highlighter-rouge">StringIO</code>,
<code class="language-plaintext highlighter-rouge">ActionDispatch::Http::UploadedFile</code>, <a href="https://github.com/shrinerb/shrine/tree/c02a005869c536eeb234353f5b1129b9e2559559#uploaded-file"><code class="language-plaintext highlighter-rouge">Shrine::UploadedFile</code></a>,
<a href="https://github.com/janko/down/tree/55c9299c170b828d83487bae7df59cfe935a1e35#streaming"><code class="language-plaintext highlighter-rouge">Down::ChunkedIO</code></a>, or any other object that implements <code class="language-plaintext highlighter-rouge">IO#read</code>.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s2">"http://example.com/upload"</span><span class="p">,</span> <span class="ss">body: </span><span class="n">io</span><span class="p">)</span> <span class="c1"># streaming upload</span>
</code></pre></div></div>

<h4 id="multipart-form-data">Multipart Form Data</h4>

<p>Http.rb will stream request bodies in <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST#Example">multipart form data</a> format as well:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"http://example.com/upload"</span><span class="p">,</span> <span class="ss">form: </span><span class="p">{</span> <span class="ss">file: </span><span class="no">HTTP</span><span class="o">::</span><span class="no">FormData</span><span class="o">::</span><span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">io</span><span class="p">)</span> <span class="p">})</span>
</code></pre></div></div>

<p>It uses the <a href="https://github.com/httprb/form_data">http-form_data</a> gem to create a <code class="language-plaintext highlighter-rouge">HTTP::FormData::Multipart</code>
object, which implements <code class="language-plaintext highlighter-rouge">IO#read</code> an generates multipart form data body
on-the-fly, so streaming works on the same principle as above. The
implementation of the streaming functionality in <code class="language-plaintext highlighter-rouge">http-form_data</code> was inspired
by the <a href="https://github.com/nicksieger/multipart-post"><code class="language-plaintext highlighter-rouge">multipart-post</code></a> gem.</p>

<p>Even though the <code class="language-plaintext highlighter-rouge">multipart-post</code> gem exists, and <a href="https://github.com/ruby/ruby/blob/v2_5_1/lib/net/http/generic_request.rb#L210-L285">Net::HTTP itself has
multipart form data functionality</a>,
<a href="https://github.com/rest-client/rest-client/blob/v2.0.2/lib/restclient/payload.rb#L116-L207">RestClient</a> and <a href="https://github.com/jnunemaker/httparty/blob/v0.16.2/lib/httparty/request/body.rb#L5">HTTParty</a> still
decided to implement their own. RestClient writes the multipart form data body
to disk before sending it (Net::HTTP does this as well), while RestClient loads
the whole body into memory. When uploading large files, both of these approaches
require resource planning, so that you don’t risk running out of disk/memory.</p>

<p>The advantage of http.rb’s streaming approach is that resource usage doesn’t
grow with the size of the request body, so it’s suitable for large payloads.
What’s also great is that <code class="language-plaintext highlighter-rouge">http-form_data</code> is a generic gem which can be reused
by any HTTP client library, so the Ruby ecosystem can standardise on this
implementation instead of reinventing the wheel.</p>

<h3 id="downloads">Downloads</h3>

<p>When you make a request with http.rb, the response headers are immediately
retrieved, but not the response body, giving you the chance to stream it if you
want to.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># retrieves the whole response body as a string</span>
<span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"http://example.com/download"</span><span class="p">).</span><span class="nf">to_s</span>

<span class="c1"># streams the response body in chunks</span>
<span class="n">response</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"http://example.com/download"</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This API allowed me to easily implement <a href="https://github.com/janko/down/tree/v4.5.0#streaming">on-demand downloads</a> for Shrine, which
is useful if you want to determine the MIME type of a remote file, but don’t
want to download the whole file for that (MIME type can typically be determined
from the first few kilobytes of the file).</p>

<p>Net::HTTP also supports streaming the response body, but the API is much more
limiting due to having to wrap the streaming in the <code class="language-plaintext highlighter-rouge">Net::HTTP.start</code> block. I
was eventually able to implement on-demand downloads for Net::HTTP as well, but
I had to <a href="/partial-downloads-with-enumerators-and-fibers/">use Fibers</a> to work around this limitation.</p>

<h2 id="persistent-connections">Persistent Connections</h2>

<p>Http.rb supports persistent (keep-alive) connections, which allows you to reuse
the same TCP socket for multiple requests to the same domain. This way you
don’t have to pay the price of establishing a connection for each request, which
can make a significant difference in performance.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># connect + write + read + close</span>
<span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># connect + write + read + close</span>
<span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># connect + write + read + close</span>
</code></pre></div></div>
<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">persistent</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># connect + write + read</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># write + read</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># write + read</span>
<span class="k">end</span>                  <span class="c1"># close</span>

<span class="c1"># OR</span>

<span class="n">http</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">persistent</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># connect + write + read</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># write + read</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1"># write + read</span>
<span class="n">http</span><span class="p">.</span><span class="nf">close</span>         <span class="c1"># close</span>
</code></pre></div></div>

<p>On a Heroku dyno, the first example takes about <strong>1.1s</strong>, whereas the example
that uses a persistent connection takes only <strong>0.6s</strong>, which shows that the
performance difference can be significant.</p>

<p>Net::HTTP also supports persistent connections, but requests have to be
performed inside the <code class="language-plaintext highlighter-rouge">Net::HTTP.start</code> block (alternatively you can use
<a href="https://github.com/drbrain/net-http-persistent">net-http-persistent</a>). HTTP client libraries built on top of libcurl
automatically use persistent connections (as that feature is built into
libcurl), so with them you don’t need to think about it.</p>

<h2 id="timeouts">Timeouts</h2>

<p>Like most HTTP client libraries, http.rb allows you to specify connect and read
timeout. Connect timeout limits the time for opening the TCP connection, while
read timeout limits the time of reading a single chunk of the response.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">timeout</span><span class="p">(</span><span class="ss">connect: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">read: </span><span class="mi">1</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"http://example.com"</span><span class="p">)</span> <span class="c1"># raises HTTP::TimeoutError</span>
</code></pre></div></div>

<p>Net::HTTP also has connect and read timeout, but it has a caveat for read
timeout – idempotent requests will be automatically retried on timeout error.
This means that, if you specify read timeout of 4 seconds, a request could
raise a timeout error only after 8 seconds, because it was already retried
once. See <a href="https://engineering.wework.com/ruby-users-be-wary-of-net-http-f284747288b2">this article</a> for more details.</p>

<h3 id="write-timeout">Write timeout</h3>

<p>In addition to connect and read timeout, http.rb also comes with a <strong>write
timeout</strong>. A write timeout limits the time it takes to write a single chunk of
the request. It’s important to have this feature when sending requests with
large bodies, as those require multiple write system calls.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">timeout</span><span class="p">(</span><span class="ss">connect: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">write: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">read: </span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>There is a <a href="https://bugs.ruby-lang.org/issues/13396">feature request</a> to add write timeout to
Net::HTTP, but as of this writing it hasn’t been implemented yet. I’m not aware
of any HTTP client library that supports write timeouts.</p>

<h3 id="global-timeout">Global timeout</h3>

<p>Requests can be written and responses can be read in multiple write or read
system calls. The default <code class="language-plaintext highlighter-rouge">:read</code> and <code class="language-plaintext highlighter-rouge">:write</code> timeout limits the time <em>for
each operation</em>. This means that if you set <code class="language-plaintext highlighter-rouge">:connect</code>, <code class="language-plaintext highlighter-rouge">:read</code>, and <code class="language-plaintext highlighter-rouge">:write</code>
timeouts to 1 second each, the request could still potentially take longer than
3 seconds if multiple write or read calls are executed.</p>

<p>Http.rb has the ability to specify a <strong>global timeout</strong>, where you can limit
the total amount of time the HTTP request can take. This is again most useful
with large amounts of data, where potentially many write/read system calls will
be executed.</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># request can take 2 + 1 + 2 = 5 seconds in total</span>
<span class="no">HTTP</span><span class="p">.</span><span class="nf">timeout</span><span class="p">(</span><span class="ss">:global</span><span class="p">,</span> <span class="ss">connect: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">write: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">read: </span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p>It might be tempting to just wrap the whole HTTP call in a <a href="https://ruby-doc.org/stdlib-2.5.1/libdoc/timeout/rdoc/Timeout.html"><code class="language-plaintext highlighter-rouge">Timeout</code></a> block,
but remember, <a href="http://www.mikeperham.com/2015/05/08/timeout-rubys-most-dangerous-api/">Timeout API is dangerous</a>. Http.rb implements read and write
timeouts natively, it only uses <code class="language-plaintext highlighter-rouge">Timeout</code> for the connect timeout (as doing it
natively is <a href="https://github.com/socketry/socketry/blob/ddc852443c66fc757f20cf0c0aacbaace6873ac4/lib/socketry/tcp/socket.rb#L81-L105">a bit more involved</a>).</p>

<h2 id="compression">Compression</h2>

<p>The HTTP 1.1 protocol supports compressing request and response bodies, which
decreases network resource usage, with the cost of increased CPU usage needed
for (de)compressing. This can improve speed when transferring large amounts of
data, depending on how well the request/response bodies compress.</p>

<p>Http.rb has support for automatically compressing (“deflating”) request bodies:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="ss">:auto_deflate</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"http://example.com/upload"</span><span class="p">,</span> <span class="ss">body: </span><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"file.txt"</span><span class="p">))</span> <span class="c1"># compression</span>

<span class="c1"># POST /upload HTTP/1.1</span>
<span class="c1"># Content-Length: 53057934</span>
<span class="c1"># Content-Encoding: gzip  &lt;========</span>
<span class="c1">#</span>
<span class="c1"># [compressed content]</span>
</code></pre></div></div>

<p>and automatically decompressing (“inflating”) response bodies:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="ss">:auto_inflate</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"http://example.com/download"</span><span class="p">)</span> <span class="c1"># compression</span>

<span class="c1"># HTTP/1.1 200 OK</span>
<span class="c1"># Content-Length: 53057934</span>
<span class="c1"># Content-Encoding: gzip  &lt;========</span>
<span class="c1">#</span>
<span class="c1"># [compressed content]</span>
</code></pre></div></div>

<p>This works with streaming requests and responses. For regular requests the
total size needs to be calculated first for setting the <code class="language-plaintext highlighter-rouge">Content-Length</code>
request header, so in this case the compressed request body will be written
to disk before it’s sent. But with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Transfer-Encoding">chunked requests</a> the request body will be
compressed on-the-fly, as those don’t require the <code class="language-plaintext highlighter-rouge">Content-Length</code> request
header.</p>

<h2 id="memory-usage">Memory Usage</h2>

<p>Ruby processes tend to consume a lot of memory. Ruby developers deal with this
in various ways: tweaking Ruby’s GC settings, killing web workers once they
reach certain memory threshold, running the Ruby processes on jemalloc etc.
However, I think there are still many opportunities for reducing the amount of
objects we allocate in the first place, which is the approach that <a href="https://schneems.com">Richard
Schneeman</a> (<a href="https://github.com/schneems/derailed_benchmarks">derailed_benchmarks</a> &amp; countless PRs), <a href="https://samsaffron.com">Sam Saffron</a>
(<a href="https://github.com/MiniProfiler/rack-mini-profiler">rack-mini-profiler</a>, <a href="https://github.com/samsaffron/memory_profiler">memory_profiler</a>, <a href="https://github.com/SamSaffron/flamegraph">flamegraph</a>, <a href="https://rubybench.org">RubyBench.org</a>), and
Eric Wong (Ruby commits) actively promote.</p>

<p>Eric Wong (Unicorn author and Ruby committer) recently talked about
this in a ruby-talk thread titled “<a href="https://rubytalk.org/t/psa-string-memory-use-reduction-techniques/74477">String memory use reduction techniques</a>”.
There, Eric states that what is often to blame for high memory usage in Ruby
applications are <strong>string objects</strong>. He shows various techniques for limiting
string allocations, as well as deallocating strings that are no longer needed.
After all, the less “garbage” there is, the better the garbage collector will
perform <img class="emoji" title=":wink:" alt=":wink:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f609.png" height="20" width="20"></p>

<p>It so happens that HTTP intractions can allocate a lot of strings, especially
for large request and response bodies. I <a href="https://gist.github.com/janko/238bbcc78b369ce3438365e5507bc671">measured</a> memory
usage of http.rb, Net::HTTP, RestClient, and HTTParty when uploading and
downloading 10 MB of data. Here are the results:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Library</th>
      <th style="text-align: right">Uploading 10MB</th>
      <th style="text-align: right">Downloading 10MB</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">http.rb</td>
      <td style="text-align: right">0.10 MB</td>
      <td style="text-align: right">0.2 MB</td>
    </tr>
    <tr>
      <td style="text-align: left">Net::HTTP</td>
      <td style="text-align: right">0.02 MB</td>
      <td style="text-align: right">12.36 MB</td>
    </tr>
    <tr>
      <td style="text-align: left">RestClient</td>
      <td style="text-align: right">9.03 MB</td>
      <td style="text-align: right">12.57 MB</td>
    </tr>
    <tr>
      <td style="text-align: left">HTTParty</td>
      <td style="text-align: right">40.03 MB</td>
      <td style="text-align: right">12.59 MB</td>
    </tr>
  </tbody>
</table>

<p>In the uploading benchmark, we can see that http.rb and Net::HTTP memory usage
is low, RestClient allocates 1x the request body size, and HTTParty allocates
4x the request body size. The http.rb memory usage is slightly higher, but it
appears to be constant regardless of the request body size. Note that with
uploads over SSL the memory usage will be much higher for each library, because
Ruby’s <code class="language-plaintext highlighter-rouge">OpenSSL::SSL::SSLSocket</code> is currently very memory-inefficient (but
there is a <a href="https://bugs.ruby-lang.org/issues/14426">patch</a> waiting to be merged).</p>

<p>In the downloading benchmark, http.rb has very low memory usage which stays the
same regardless of the response body size, while the other libraries allocate
approximately 1x the response body size (due to Net::HTTP). Note that this
will be fixed in Ruby 2.6.0 due to Eric Wong’s recent <a href="https://bugs.ruby-lang.org/issues/14326">patch</a>, after which memory consumption drops to the same levels as
http.rb.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I found http.rb to be a very impressive HTTP client library. It has a very nice
easy-to-use API, good exception hierarchy, full streaming support, persistent
connections, advanced timeout options, HTTP compression support and more.</p>

<p>I believe that one of the main things that helped it shape up is implementing
the HTTP protocol natively instead of relying on Net::HTTP. This also spawned
some reusable libraries – <a href="https://github.com/socketry/socketry">Socketry</a>, <a href="https://github.com/httprb/form_data">http-form_data</a>, and <a href="https://github.com/httprb/content_type.rb">content-type</a> –
which is always sound sign of good design in my book.</p>

<p>Since I maintain libraries for handling file uploads and downloads (<a href="https://github.com/shrinerb/shrine">Shrine</a>,
<a href="https://github.com/janko/down">Down</a>, <a href="https://github.com/janko/tus-ruby-server">tus-ruby-server</a>), it’s important to me to have an HTTP client library
that I can recommend. The streaming upload/download support and very low memory
usage makes http.rb a great choice, especially when dealing with large files.</p>

<p>I encourage you to try http.rb on your next project!</p>


  </div>
</article>

<div class="mt-8 md:mt-10">
  <div class="flex items-center space-x-4 md:space-x-6 mx-0 lg:-mx-6 bg-blue-50 border border-sky-200 bg-sky-50 px-4 py-3 md:py-5 md:px-6 rounded-xl overflow-x-scroll dark:bg-sky-950 dark:border-sky-600">
  <img src="/images/me.jpg" class="h-20 w-20 xs:h-24 xs:w-24 sm:h-32 sm:w-32 rounded-xl">
  <div class="flex flex-col justify-center">
    
      <h3 class="font-medium text-slate-900 dark:text-slate-200 mb-2 text-xl xs:text-2xl">
        Janko Marohnić
      </h3>
    
    <p class="text-slate-900 dark:text-slate-200 text-sm xs:text-base md:text-lg hidden sm:block">
      Ruby developer, Rails critic, open source maintainer, creator of
      <a class="text-pink-700 underline dark:text-pink-500 decoration-pink-700/30 transition hover:text-pink-800 hover:decoration-pink-800 dark:hover:text-pink-400 dark:decoration-pink-500/40 dark:hover:decoration-pink-400" href="https://shrinerb.com" target="_blank">Shrine</a>,
      <a class="text-pink-700 underline dark:text-pink-500 decoration-pink-700/30 transition hover:text-pink-800 hover:decoration-pink-800 dark:hover:text-pink-400 dark:decoration-pink-500/40 dark:hover:decoration-pink-400" href="https://github.com/vim-test/vim-test" target="_blank">vim-test</a> and
      <a class="text-pink-700 underline dark:text-pink-500 decoration-pink-700/30 transition hover:text-pink-800 hover:decoration-pink-800 dark:hover:text-pink-400 dark:decoration-pink-500/40 dark:hover:decoration-pink-400" href="https://github.com/janko/rodauth-rails" target="_blank">rodauth-rails</a>.
    </p>

    <div class="mt-2 xs:mt-4 sm:mt-5 flex items-center space-x-3 xs:space-x-5">
      

      <a href="https://github.com/janko" title="GitHub" target="_blank">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out dark:hidden" viewbox="0 0 24 24">
          <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
        </svg>
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out hidden dark:block" viewbox="0 0 100 100">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"></path>
        </svg>
      </a>
      <a href="https://twitter.com/jankomarohnic" title="Twitter" target="_blank">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out" viewbox="0 0 20 20" fill="currentColor">
          <path fill="#1d9bf0" d="M17.316 6.246c0.008 0.162 0.011 0.326 0.011 0.488 0 4.99-3.797 10.742-10.74 10.742-2.133 0-4.116-0.625-5.787-1.697 0.296 0.035 0.596 0.053 0.9 0.053 1.77 0 3.397-0.604 4.688-1.615-1.651-0.031-3.046-1.121-3.526-2.621 0.23 0.043 0.467 0.066 0.71 0.066 0.345 0 0.679-0.045 0.995-0.131-1.727-0.348-3.028-1.873-3.028-3.703 0-0.016 0-0.031 0-0.047 0.509 0.283 1.092 0.453 1.71 0.473-1.013-0.678-1.68-1.832-1.68-3.143 0-0.691 0.186-1.34 0.512-1.898 1.861 2.285 4.644 3.787 7.781 3.945-0.064-0.277-0.097-0.564-0.097-0.861 0-2.084 1.689-3.773 3.774-3.773 1.086 0 2.067 0.457 2.756 1.191 0.859-0.17 1.667-0.484 2.397-0.916-0.282 0.881-0.881 1.621-1.66 2.088 0.764-0.092 1.49-0.293 2.168-0.594-0.506 0.758-1.146 1.422-1.884 1.953z"></path>
        </svg>
      </a>
      <a href="https://www.youtube.com/@jankomarohnic" title="YouTube" target="_blank">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out" viewbox="0 0 159 110" fill="currentColor">
          <path d="m154 17.5c-1.82-6.73-7.07-12-13.8-13.8-9.04-3.49-96.6-5.2-122 0.1-6.73 1.82-12 7.07-13.8 13.8-4.08 17.9-4.39 56.6 0.1 74.9 1.82 6.73 7.07 12 13.8 13.8 17.9 4.12 103 4.7 122 0 6.73-1.82 12-7.07 13.8-13.8 4.35-19.5 4.66-55.8-0.1-75z" fill="#f00"></path>
          <path d="m105 55-40.8-23.4v46.8z" fill="#fff"></path>
        </svg>
      </a>
      <a href="https://www.linkedin.com/in/janko-marohnic/" title="LinkedIn" target="_blank">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out" viewbox="0 0 72 72" width="72">
          <g fill="none" fill-rule="evenodd"><path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" fill="#007EBB"></path><path d="M62,62 L51.315625,62 L51.315625,43.8021149 C51.315625,38.8127542 49.4197917,36.0245323 45.4707031,36.0245323 C41.1746094,36.0245323 38.9300781,38.9261103 38.9300781,43.8021149 L38.9300781,62 L28.6333333,62 L28.6333333,27.3333333 L38.9300781,27.3333333 L38.9300781,32.0029283 C38.9300781,32.0029283 42.0260417,26.2742151 49.3825521,26.2742151 C56.7356771,26.2742151 62,30.7644705 62,40.051212 L62,62 Z M16.349349,22.7940133 C12.8420573,22.7940133 10,19.9296567 10,16.3970067 C10,12.8643566 12.8420573,10 16.349349,10 C19.8566406,10 22.6970052,12.8643566 22.6970052,16.3970067 C22.6970052,19.9296567 19.8566406,22.7940133 16.349349,22.7940133 Z M11.0325521,62 L21.769401,62 L21.769401,27.3333333 L11.0325521,27.3333333 L11.0325521,62 Z" fill="#FFF"></path></g>
        </svg>
      </a>
      <a href="https://speakerdeck.com/janko_m" title="Speaker Deck" target="_blank">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out" viewbox="0 0 256 160">
          <g><path d="M106.932331,100 L50,100 C22.3857624,100 0,77.6142376 0,50 C0,22.3857624 22.3857624,0 50,0 L116.421053,0 C127.466748,0 136.421053,8.9543048 136.421053,20 C136.421053,31.0456952 127.466748,40 116.421053,40 L48.977444,40 C43.454596,40 38.977444,44.4771528 38.977444,50 C38.977444,55.5228472 43.454596,60 48.977444,60 L105.909774,60 C133.524012,60 155.909774,82.3857624 155.909774,110 C155.909774,137.614238 133.524012,160 105.909774,160 L20,160 C8.9543048,160 0,151.045695 0,140 C0,128.954305 8.9543048,120 20,120 L106.932331,120 C112.455178,120 116.932331,115.522847 116.932331,110 C116.932331,104.477153 112.455178,100 106.932331,100 Z M149.013633,160 C162.31303,151.005667 171.818454,136.66797 174.567639,120 L206.843433,120 C212.273117,120 216.674746,115.522847 216.674746,110 L216.674746,50 C216.674746,44.4771528 212.273117,40 206.843433,40 L148.210526,40 C152.880793,34.6924352 155.720602,27.683544 155.720602,20 C155.720602,12.316456 152.880793,5.3075648 148.210526,0 L216.674746,0 C238.393484,0 256,17.9086104 256,40 L256,120 C256,142.09139 238.393484,160 216.674746,160 L149.013633,160 Z" fill="#009287"></path></g>
        </svg>
      </a>
      <a href="mailto:janko@hey.com" title="Email">
        <svg class="w-5 h-5 xs:w-6 xs:h-6 sm:w-7 sm:h-7 transition hover:scale-[1.2] duration-200 ease-in ease-out text-red-500" viewbox="0 0 20 20" fill="currentColor">
          <path d="M1.574 5.286c0.488 0.262 7.248 3.894 7.5 4.029s0.578 0.199 0.906 0.199c0.328 0 0.654-0.064 0.906-0.199s7.012-3.767 7.5-4.029c0.489-0.263 0.951-1.286 0.054-1.286h-16.919c-0.897 0-0.435 1.023 0.053 1.286zM18.613 7.489c-0.555 0.289-7.387 3.849-7.727 4.027s-0.578 0.199-0.906 0.199-0.566-0.021-0.906-0.199-7.133-3.739-7.688-4.028c-0.39-0.204-0.386 0.035-0.386 0.219s0 7.293 0 7.293c0 0.42 0.566 1 1 1h16c0.434 0 1-0.58 1-1 0 0 0-7.108 0-7.292s0.004-0.423-0.387-0.219z"></path>
        </svg>
      </a>
    </div>
  </div>
</div>

</div>

<div class="mt-8 md:mt-10">
  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'twinblog'; // required: replace example with your forum shortname
    var disqus_identifier = '/httprb-is-great';
    var disqus_url = 'https://janko.io/httprb-is-great/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div>

      </main>
    </div>

    <div class="border-t py-7 mt-10 bg-gray-50 dark:bg-slate-950 dark:border-slate-700">
      <footer class="max-w-screen-sm md:max-w-screen-md mx-auto flex flex-col space-y-2 md:flex-row md:justify-between md:space-y-0 text-base">
        <ul class="inline-flex space-x-4 font-medium justify-center md:justify-left">
          <li><a class="transition hover:text-pink-600" href="/">Articles</a></li>
          <li><a class="transition hover:text-pink-600" href="https://github.com/janko/janko.io">Source code</a></li>
        </ul>
        <p class="text-slate-500 text-center md:text-left">
          © 2023 Janko Marohnić. All rights reserved.
        </p>
      </footer>
    </div>

    <script>
      function toggleClass(element, classNames, force) {
        classNames.split(' ').forEach(function(className) {
          element.classList.toggle(className, force)
        })
      }

      const btnToggle = document.querySelector('.theme-toggle')
      const btnReset = document.querySelector('.theme-reset')

      function syncTheme() {
        const enabled = document.documentElement.classList.contains('dark')

        const ring = btnToggle.querySelector('.theme-toggle-ring')
        const light = btnToggle.querySelector('.theme-toggle-light')
        const dark = btnToggle.querySelector('.theme-toggle-dark')

        toggleClass(btnToggle, 'bg-pink-500', enabled)
        toggleClass(btnToggle, 'bg-slate-200', !enabled)

        toggleClass(ring, 'translate-x-5', enabled)
        toggleClass(ring, 'translate-x-0', !enabled)

        toggleClass(light, 'opacity-0 duration-100 ease-out', enabled)
        toggleClass(light, 'opacity-100 duration-200 ease-in', !enabled)

        toggleClass(dark, 'opacity-100 duration-200 ease-in', enabled)
        toggleClass(dark, 'opacity-0 duration-100 ease-out', !enabled)
      }

      btnToggle.addEventListener('click', function() {
        const enabled = document.documentElement.classList.toggle('dark')

        localStorage.theme = enabled ? 'dark' : 'light'

        syncTheme()

        btnReset.classList.remove('hidden')
      })

      btnReset.addEventListener('click', function() {
        localStorage.removeItem('theme')

        updateTheme()
        syncTheme()

        btnReset.classList.add('hidden')
      })

      syncTheme()
      btnReset.classList.toggle('hidden', !('theme' in localStorage))
    </script>
  </body>
</html>
