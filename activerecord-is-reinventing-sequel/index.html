<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ActiveRecord is reinventing Sequel | Janko's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="ActiveRecord is reinventing Sequel" />
<meta name="author" content="Janko Marohniƒá" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="For those who don‚Äôt know, Sequel is an ORM very similar to ActiveRecord, in a way that it also implements the Active Record pattern. As of this writing it‚Äôs 9 years old. I‚Äôve already written about some of the main advantages of Sequel over ActiveRecord (and other people have as well: 1, 2)." />
<meta property="og:description" content="For those who don‚Äôt know, Sequel is an ORM very similar to ActiveRecord, in a way that it also implements the Active Record pattern. As of this writing it‚Äôs 9 years old. I‚Äôve already written about some of the main advantages of Sequel over ActiveRecord (and other people have as well: 1, 2)." />
<link rel="canonical" href="https://janko.io/activerecord-is-reinventing-sequel/" />
<meta property="og:url" content="https://janko.io/activerecord-is-reinventing-sequel/" />
<meta property="og:site_name" content="Janko‚Äôs Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-04T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ActiveRecord is reinventing Sequel" />
<meta name="twitter:site" content="@jankomarohnic" />
<meta name="twitter:creator" content="@jankomarohnic" />
<meta property="article:publisher" content="https://www.facebook.com/janko.marohnic/" />
<script type="application/ld+json">
{"dateModified":"2016-03-04T00:00:00+01:00","datePublished":"2016-03-04T00:00:00+01:00","headline":"ActiveRecord is reinventing Sequel","mainEntityOfPage":{"@type":"WebPage","@id":"https://janko.io/activerecord-is-reinventing-sequel/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://janko.io/images/logo.png"},"name":"Janko Marohniƒá"},"author":{"@type":"Person","name":"Janko Marohniƒá"},"@type":"BlogPosting","description":"For those who don‚Äôt know, Sequel is an ORM very similar to ActiveRecord, in a way that it also implements the Active Record pattern. As of this writing it‚Äôs 9 years old. I‚Äôve already written about some of the main advantages of Sequel over ActiveRecord (and other people have as well: 1, 2).","url":"https://janko.io/activerecord-is-reinventing-sequel/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link type="application/atom+xml" rel="alternate" href="https://janko.io/feed.xml" title="Janko&apos;s Blog" />
    <link rel="stylesheet" href="/css/bundle.css">
  </head>

  <body class="text-xl text-gray-700 dark:bg-slate-900 dark:text-gray-400">
    <header class="py-3 px-4 flex flex-col space-y-1 bg-gray-100 border-b dark:bg-gray-800/70 dark:border-sky-300">
      <div class="flex justify-center">
        <a class="flex items-center space-x-2" href="/">
          <img class="h-8" src="/images/logo.png" alt="logo">
          <span class="text-2xl md:text-3xl font-semibold text-pink-700 dark:text-pink-500">Janko's Blog</span>
        </a>
      </div>
      <div class="flex justify-center">
        <span class="text-base md:text-lg text-gray-500 dark:text-gray-400">Sharing the wonders of Ruby
      </span>
</div>
    </header>

    <div class="text-center py-3 px-4 bg-sky-50 border-b border-sky-100 text-sky-600 text-base md:text-md lg:text-lg dark:text-sky-300 dark:bg-sky-900/40 dark:border-sky-300">
      Dear Russian friends, please watch President Zelenskyy's <a href="https://www.youtube.com/watch?v=p-zilnPtZ2M" class="underline text-blue-600 hover:text-blue-500 dark:text-blue-500 dark:hover:text-blue-400">speech addressed to you</a>.
      üá∫üá¶ Support Ukraine by <a href="https://war.ukraine.ua/support-ukraine/" class="underline text-yellow-600 hover:text-yellow-500 dark:text-yellow-500 dark:hover:text-yellow-400">donating</a> to humanitarian aid.
    </div>

    <div class="my-6 sm:my-8 mx-4">
      <main class="max-w-screen-sm md:max-w-screen-md mx-auto">
        <article>
  <header class="space-y-4 md:space-y-5">
    <h1 class="lg:-mx-28 text-3xl sm:text-4xl lg:text-5xl text-center font-medium text-gray-900 dark:text-gray-100">ActiveRecord is reinventing Sequel</h1>

    <div class="flex justify-center">
      <div class="flex flex-col items-center sm:flex-row sm:items-baseline space-y-3 sm:space-y-0 sm:space-x-4 text-sm md:text-base">
        <span class="text-gray-500 dark:text-gray-400">
          By <a class="underline hover:text-gray-300" href="/about">Janko Marohniƒá</a> on
          <time datetime="2016-03-04 00:00:00 +0100">
            04 Mar 2016
          </time>
        </span>
        
          
<a class="my-1 rounded-full px-3 bg-yellow-100 text-yellow-700 font-semibold py-0.5 dark:bg-yellow-900 dark:text-yellow-300" href="/sequel">sequel</a>


        
      </div>
    </div>
  </header>

  <div class="mt-4 sm:mt-6 markdown">
    <p>For those who don‚Äôt know, <a href="http://github.com/jeremyevans/sequel">Sequel</a> is an ORM very similar to ActiveRecord, in a
way that it also implements the <a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">Active Record pattern</a>. As of this writing
it‚Äôs 9 years old. I‚Äôve already <a href="/ode-to-sequel/">written</a>
about some of the main advantages of Sequel over ActiveRecord (and other people
have as well:
<a href="http://rosenfeld.herokuapp.com/en/articles/ruby-rails/2013-12-18-sequel-is-awesome-and-much-better-than-activerecord">1</a>,
<a href="https://mrbrdo.wordpress.com/2013/10/15/why-you-should-stop-using-activerecord-and-start-using-sequel/">2</a>).</p>

<p>I‚Äôm using Sequel for over a year now, and am finding it to be consistently
better than ActiveRecord. But that‚Äôs just my opinion, right? You can‚Äôt really
say that one tool is objectively better than the other, each tool has its
tradeoffs.</p>

<p>Well, sometimes you simply can. What I‚Äôve noticed is that, whenever a new shiny
ActiveRecord feature comes, Sequel has already had the same feature for quite
some time. That would be ok if these were a few isolated incidents, but
they‚Äôre really not. ActiveRecord appears to have been consistently reinventing
Sequel.</p>

<p>Wait, that can‚Äôt be right. ActiveRecord is insanely popular and it‚Äôs part of
Rails, the Rails team surely wouldn‚Äôt work so hard reimplementing something
that already exists. Anyway, that is a huge accusation, how can I possibly
prove my claims? Give me a chance, I really do have evidence. A <em>lot</em> of
evidence.</p>

<p>What I will do is walk you through ActiveRecord‚Äôs most notable updates, and
look for Sequel‚Äôs equivalents. I will also compare times when a feature landed
on both ORMs. I will list the features roughly in reverse chronological order
(from newest to oldest), so that we start from fresh memories.</p>

<h2 id="activerecord-5">ActiveRecord 5</h2>

<h3 id="or">OR</h3>

<p>The <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#or</code> query method allows use of the OR operator
(previously you‚Äôd have to write SQL strings):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Post</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="mi">1</span><span class="p">).</span><span class="nf">or</span><span class="p">(</span><span class="no">Post</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># =&gt; SELECT * FROM posts WHERE (id = 1) OR (id = 2)</span>
</code></pre></div></div>

<p>Implementing this feature required a
<a href="https://github.com/rails/rails/pull/9052">lot</a>
<a href="https://github.com/rails/rails/pull/18706">of</a>
<a href="https://github.com/rails/rails/pull/16052">discussion</a>.
The feature finally landed in ActiveRecord (<a href="https://github.com/rails/rails/commit/9e42cf019f2417473e7dcbfcb885709fa2709f89">commit</a>),
only <strong>8 years</strong> behind Sequel (<a href="https://github.com/jeremyevans/sequel/blob/305b965a2790675bc920f8d2d1a3bc194e366af4/lib/sequel/dataset/sql.rb#L235">code</a>).</p>

<h3 id="left-joins">Left joins</h3>

<p>The <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#left_joins</code> query method generates a LEFT OUTER
JOIN (previously kind of possible via <code class="language-plaintext highlighter-rouge">#eager_load</code>):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">left_joins</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span>
<span class="c1"># =&gt; SELECT "users".* FROM "users" LEFT OUTER JOIN "posts" ON "posts"."user_id" = "users"."id"</span>
</code></pre></div></div>

<p>The feature landed in ActiveRecord in 2015
(<a href="https://github.com/rails/rails/pull/12071">PR</a>). On the other hand, Sequel
has had support for all types of JOINs since <strong>2008</strong>, and added ‚Äúassociation
joins‚Äù in <strong>2014</strong> (<a href="https://github.com/jeremyevans/sequel/commit/8dbec2f404703a0b265763c94af901f6053c22fa">commit</a>).</p>

<h3 id="attributes-api">Attributes API</h3>

<p>The <a href="http://edgeapi.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute">attributes API</a>
allows specifying/overriding types of columns/accessors in your models, as well
as querying with instances of those types, and bunch of other things.</p>

<p>It‚Äôs difficult to point out at a specific equivalent in Sequel since the area
of ActiveRecord‚Äôs attributes API is so broad. In my opinion you can roughly
achieve the same features with <a href="http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/Serialization.html">serialization</a>, <a href="http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/SerializationModificationDetection.html">serialization_modification_detection</a>,
<a href="http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/Composition.html">composition</a>, <a href="http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/TypecastOnLoad.html">typecast_on_load</a>, and <a href="http://sequel.jeremyevans.net/rdoc-plugins/classes/Sequel/Plugins/DefaultsSetter.html">defaults_setter</a> plugins.</p>

<h3 id="views">Views</h3>

<p>The <code class="language-plaintext highlighter-rouge">ActiveRecord::ConnectionAdapters::AbstractAdapter#views</code> method defined on
connection adapters returns an array of database view names:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">views</span> <span class="c1">#=&gt; ["recent_posts", "popular_posts", ...]</span>
</code></pre></div></div>

<p>Sequel implemented <code class="language-plaintext highlighter-rouge">#views</code> in 2011
(<a href="https://github.com/jeremyevans/sequel/commit/ed27c3856fde5a5e03c4940db50fa93f4d9fd99a">commit</a>),
<strong>4 years</strong> before ActiveRecord (<a href="https://github.com/rails/rails/commit/dcd39949f8801cb4beddec37143a585259f09a2d">commit</a>).</p>

<h3 id="indexing-concurrently">Indexing Concurrently</h3>

<p>This PostgreSQL feature is crucial for zero-downtime migrations on larger
tables, ActiveRecord has had adding indices concurrently since 2013
(<a href="https://github.com/rails/rails/commit/e199dc1a570d4f0d9a07628268835bce5aab2732">commit</a>),
and dropping concurrently since 2015
(<a href="https://github.com/rails/rails/commit/ce17e232a12861bce4bd950d7143df3fe0cd1991">commit</a>).</p>

<p>Sequel supported both adding and dropping indices concurrently since <strong>2012</strong>
(<a href="https://github.com/jeremyevans/sequel/commit/61593033c05f5f52617f0c72bdc63d92a020bfff">commit</a>).</p>

<h3 id="in-batches">In batches</h3>

<p><code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#in_batches</code> yields batches of relations, suitable for
batched updates or deletes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Person</span><span class="p">.</span><span class="nf">in_batches</span> <span class="p">{</span> <span class="o">|</span><span class="n">people</span><span class="o">|</span> <span class="n">people</span><span class="p">.</span><span class="nf">update_all</span><span class="p">(</span><span class="ss">awesome: </span><span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div>

<p>Sequel doesn‚Äôt have an equivalent, because there is no one right way to do
batched updates, it depends on the situation. For example, the following Sequel
implementation in my benchmarks showed to be 2x faster than ActiveRecord‚Äôs:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="no">Person</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="ss">:id</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="no">Person</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">id: </span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">..</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)).</span><span class="nf">update</span><span class="p">(</span><span class="ss">awesome: </span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="aborting-hooks">Aborting hooks</h3>

<p>Before Rails 5, returning <code class="language-plaintext highlighter-rouge">false</code> in any <code class="language-plaintext highlighter-rouge">before_*</code> callback resulted in
halting of callback chain. The new version
<a href="https://github.com/rails/rails/pull/17227">removes</a> this behaviour and
requires you to be explicit about it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_save</span> <span class="k">do</span>
    <span class="kp">throw</span><span class="p">(</span><span class="ss">:abort</span><span class="p">)</span> <span class="k">if</span> <span class="n">some_condition</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is actually one of the rare cases where Sequel <a href="https://github.com/jeremyevans/sequel/commit/2475df6223b92923dffe0bc4de4eb6bf21eda640">added the equivalent
<code class="language-plaintext highlighter-rouge">cancel_action</code> method</a>
being inspired by ActiveRecord‚Äôs change <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20">.</p>

<h2 id="activerecord-4">ActiveRecord 4</h2>

<h3 id="adequate-record">Adequate Record</h3>

<p><a href="https://tenderlovemaking.com/2014/02/19/adequaterecord-pro-like-activerecord.html">Adequate Record</a> is a set of performance improvements in ActiveRecord that
makes common <code class="language-plaintext highlighter-rouge">find</code> and <code class="language-plaintext highlighter-rouge">find_by</code> calls and some association queries up to 2x
faster.</p>

<p>However, running the <a href="https://github.com/jeremyevans/simple_orm_benchmark">ORM benchmark</a> shows that Sequel is still much, much
faster than ActiveRecord, even after the Adequate Record merge.</p>

<h3 id="postgres-json-array-and-hstore">Postgres JSON, array and hstore</h3>

<p>ActiveRecord 4 added support for Postgres JSON, array and hstore columns, along
with automatic typecasting. From looking at the commits we can say that
ActiveRecord received these features roughly at the same time as Sequel
(<a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_json_rb.html">pg_json</a>, <a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_array_rb.html">pg_array</a>, <a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_hstore_rb.html">pg_hstore</a>), which is around the time these
features got added to Postgres. Note that Sequel on top of this also has an API
for <em>querying</em> these types of columns (<a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_json_ops_rb.html">pg_json_ops</a>, <a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_array_ops_rb.html">pg_array_ops</a>,
<a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_hstore_ops_rb.html">pg_hstore_ops</a>), which greatly improves readability.</p>

<h3 id="mutation-detection">Mutation detection</h3>

<p>ActiveRecord 4.2+ automatically detects in-place changes to columns values, and
marks the record as dirty. Sequel added this feature through
<a href="https://github.com/jeremyevans/sequel/commit/a9c4e060f436a9084d533c054395746cd8ae6bf1">modification_detection</a>
plugin after ActiveRecord. But note that in Sequel this is opt-in, so that
users can decide whether they want the performance hit.</p>

<h3 id="where-not">Where not</h3>

<p>The <code class="language-plaintext highlighter-rouge">where.not</code> query construct allows negating a <code class="language-plaintext highlighter-rouge">where</code> clause, eliminating
the need to write SQL strings:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Person</span><span class="p">.</span><span class="nf">where</span><span class="p">.</span><span class="nf">not</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John"</span><span class="p">)</span>
</code></pre></div></div>

<p>It was added in 2012 (<a href="https://github.com/rails/rails/commit/de75af7acc5c05c708443de40e78965925165217">commit</a>),
in which time Sequel‚Äôs equivalent <code class="language-plaintext highlighter-rouge">exclude</code> was existing already for <strong>5 years</strong>
(<a href="https://github.com/jeremyevans/sequel/blob/305b965a2790675bc920f8d2d1a3bc194e366af4/lib/sequel/dataset/sql.rb#L263">code</a>).</p>

<h3 id="rewhere">Rewhere</h3>

<p>In 2013 <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#rewhere</code> was
<a href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">added</a>
allowing you to overwrite all existing WHERE conditions with new ones:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Person</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Mr. Anderson"</span><span class="p">).</span><span class="nf">rewhere</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Neo"</span><span class="p">)</span>
</code></pre></div></div>

<p>Sequel has had <code class="language-plaintext highlighter-rouge">unfiltered</code>, which removes existing WHERE and HAVING conditions,
since 2008, <strong>5 years</strong> before this ActiveRecord update
(<a href="https://github.com/jeremyevans/sequel/commit/691a5c31a0f64d764a975c4bc563eb8de8b38507">commit</a>).</p>

<h3 id="enum">Enum</h3>

<p><code class="language-plaintext highlighter-rouge">ActiveRecord::Base#enum</code> was added to ActiveRecord 4.1
(<a href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">commit</a>),
giving the ability to map names to integer columns:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Conversation</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status: </span><span class="p">[</span><span class="ss">:active</span><span class="p">,</span> <span class="ss">:archived</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>While Sequel doesn‚Äôt have this database-agnostic feature, it has the <a href="http://sequel.jeremyevans.net/rdoc-plugins/files/lib/sequel/extensions/pg_enum_rb.html">pg_enum</a>
plugin for Postgres‚Äô enum type, although it was added only 1 year after
ActiveRecord‚Äôs enum.</p>

<h3 id="automatic-inverse-associations">Automatic inverse associations</h3>

<p>ActiveRecord 4.1 added a feature to automatically detect inverse associations,
instead of having to always use <code class="language-plaintext highlighter-rouge">:inverse_of</code>
(<a href="https://github.com/rails/rails/commit/ae6e6d953084d1966e52cc06ffe24131f0115cc1">commit</a>).</p>

<p>Sequel had this basically since it added associations in 2008, which was about
<strong>5 years</strong> before ActiveRecord‚Äôs update.</p>

<h3 id="contextual-validations">Contextual validations</h3>

<p><a href="https://github.com/rails/rails/commit/50d971710150533562240bef660f14237b70d939">Contextual validations</a>
allow passing a symbol when validating, and doing validations depending on the
existence or absence of the given symbol.</p>

<p>Sequel doesn‚Äôt have this feature, since it‚Äôs a code smell to have this in the
model, but Sequel‚Äôs <a href="http://sequel.jeremyevans.net/rdoc/files/doc/validations_rdoc.html#label-validation_helpers">instance-level validations</a> allow you to validate records
from service objects, which is a much better way of doing contextual
validation.</p>

<h3 id="reversibility-improvements">Reversibility improvements</h3>

<p>ActiveRecord 4.0 improved writing reversible migrations by allowing destructive
methods like <code class="language-plaintext highlighter-rouge">remove_column</code> to be reversible, as well as adding a really handy
<code class="language-plaintext highlighter-rouge">ActiveRecord::Migration#reversible</code> method allowing you to write everything in
a <code class="language-plaintext highlighter-rouge">change</code>, not having to switch to <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code>.</p>

<p>Sequel‚Äôs reversing capabilities are a bit lacking compared to ActiveRecord‚Äôs,
they are currently about the same as ActiveRecord‚Äôs before this change.</p>

<h3 id="null-relation">Null relation</h3>

<p>ActiveRecord 4.0 added a handy <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#none</code> which represents
an empty relation, effectively implementing a null object pattern for relations.</p>

<p>Sequel <a href="https://github.com/jeremyevans/sequel/commit/e1e3207583c39ec69ea030e29b331868308c672c">added a null_dataset
plugin</a>
as an inspiration to ActiveRecord‚Äôs feature.</p>

<h2 id="activerecord-3">ActiveRecord 3</h2>

<h3 id="explain">EXPLAIN</h3>

<p>In 2011 ActiveRecord 3.2 added <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#explain</code> for EXPLAIN-ing
queries
(<a href="https://github.com/rails/rails/commit/e7b7b4412380e7ce2d8e6ae402cb7fe02d7666b8">commit</a>).
Sequel has had EXPLAIN support for Postgres since 2007
(<a href="https://github.com/jeremyevans/sequel/blob/305b965a2790675bc920f8d2d1a3bc194e366af4/core/lib/sequel/adapters/postgres.rb#L365">code</a>),
and for MySQL was added only later in 2012
(<a href="https://github.com/jeremyevans/sequel/commit/7708ec277572ddf36eee3999f20e67bedb07ac5b">commit</a>).</p>

<h3 id="pluck">Pluck</h3>

<p>ActiveRecord 3.2 added <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#pluck</code> in 2011
(<a href="https://github.com/rails/rails/commit/a382d60f6abc94b6a965525872f858e48abc00de">commit</a>),
and added support for multiple columns in 2012 (<a href="https://github.com/rails/rails/commit/2e379c1e63b3646f9aff4d7e242ca37b4a57f529">commit</a>).</p>

<p>Sequel‚Äôs equivalent <code class="language-plaintext highlighter-rouge">Sequel::Dataset#select_map</code> existed since 2009
(<a href="https://github.com/jeremyevans/sequel/commit/ee3445294f5a83fdc02d5f03129eac839fdc74d2">commit</a>),
and support for multiple columns was added in 2011 (<a href="https://github.com/jeremyevans/sequel/commit/3075880a2e0c4b42cc064cb5c342eb879bd809a1">commit</a>).</p>

<h3 id="uniq">Uniq</h3>

<p>ActiveRecord 3.2 added SELECT DISTINCT through <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation#uniq</code> in
2011 (<a href="https://github.com/rails/rails/commit/562583c7667f508493ab8c5b1a4215087fafd22d">commit</a>).
Sequel has had equivalent <code class="language-plaintext highlighter-rouge">Sequel::Dataset#distinct</code> since 2007
(<a href="https://github.com/jeremyevans/sequel/blob/a3c54c62a16b74218ba2311fb482b0b625972cd5/sequel_core/lib/sequel_core/dataset/sql.rb#L264">code</a>),
<strong>4 years</strong> ahead of ActiveRecord.</p>

<h3 id="update-column">Update column</h3>

<p>ActiveRecord 3.1. added <code class="language-plaintext highlighter-rouge">ActiveRecord::Base#update_column</code> for updating
attributes without executing validations or callbacks
(<a href="https://github.com/rails/rails/commit/245542ea2994961731be105db6c076256a22a7a9">commit</a>).
The equivalent behaviour in Sequel, <code class="language-plaintext highlighter-rouge">user.this.update(...)</code>, at that moment
already existed for <strong>4 years</strong>.</p>

<h3 id="reversible-migrations">Reversible migrations</h3>

<p>ActiveRecord 3.1 added support for reversible migrations via <code class="language-plaintext highlighter-rouge">change</code>
(<a href="https://github.com/jeremyevans/sequel/commit/94450d775dfdc1b6cc0393944198bfa2ea0ecd71">commit</a>).
Soon after that, and inspired by ActiveRecord, Sequel added its support for
reversible migrations (<a href="https://github.com/jeremyevans/sequel/commit/94450d775dfdc1b6cc0393944198bfa2ea0ecd71">commit</a>).</p>

<h3 id="arel">Arel</h3>

<p>Finally, we come probably to ActiveRecord‚Äôs biggest update: the chainable query
interface and extraction of <a href="https://github.com/rails/arel">Arel</a>. For those who don‚Äôt know, ActiveRecord
prior to 3.0 didn‚Äôt have a chainable query interface.</p>

<p>Sequel already had this chainable query interface, before Nick Kallen started
working on Arel (<a href="http://sequel.jeremyevans.net/2010/02/06/arel-sequel-differences-part-1.html">source</a>),
meaning he was obviously inspired by Sequel. Also, building queries with Arel
looks very different than through models (it‚Äôs arguably more clunky), while
Sequel‚Äôs low-level interface gives you the exact same API as you have through
models.</p>

<p>Alternative to Arel for building complex queries is <a href="https://github.com/activerecord-hackery/squeel">Squeel</a>. Beside the
obvious insipration indicated by the anagram in the name (even though there is
no mention of it in the README), the interface obviously mimics Sequel‚Äôs
<a href="http://sequel.jeremyevans.net/rdoc/files/doc/virtual_rows_rdoc.html">virtual row blocks</a>.</p>

<h2 id="aftermath">Aftermath</h2>

<p>In this detailed overview, even though Sequel was ahead of ActiveRecord in vast
majority of cases, there were a few cases where ActiveRecord was leading the
way:</p>

<ul>
  <li>Reversible migrations</li>
  <li>Aborting hooks</li>
  <li>Mutation detection</li>
  <li>Enum (kind of)</li>
  <li>Null relation</li>
</ul>

<p>We see that Sequel was closely keeping up with ActiveRecord, but ActiveRecord
wasn‚Äôt keeping up with Sequel. Note that on GitHub Sequel maintains 0 open
issues, while ActiveRecord circles around 300 open issues. It‚Äôs also worth
mentioning that Sequel is maintained mainly by one developer, while
ActiveRecord is developed by most of the Rails team.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I want that you think about this. ActiveRecord was mainly implementing features
that Sequel already had. That could be justified if ActiveRecord had some other
advantages over Sequel, but I‚Äôm failing to see them. I don‚Äôt classify
integration with Rails as an advantage (you can just make a <a href="https://github.com/TalentBox/sequel-rails">sequel-rails</a> for
that), I mean advantages that actually help interacting with databases.</p>

<p>I wished that I used Sequel from day one, instead of starting with ActiveRecord
and slowly realizing that Sequel is better. The only reason ActiveRecord is so
popular is because it‚Äôs part of Rails, not because it‚Äôs better. There is a
reason why <a href="https://github.com/hanami/model">hanami-model</a> and <a href="https://github.com/rom-rb/rom-sql">ROM</a> use Sequel under-the-hood and not
ActiveRecord. It hurts me that so many developer hours are put into
ActiveRecord, and I don‚Äôt see for what purpose; a better tool already exists
and is excellently maintainted. Let‚Äôs direct our energy towards the better
tool.</p>


  </div>
</article>

<div class="mt-8 md:mt-10">
  
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'twinblog'; // required: replace example with your forum shortname
    var disqus_identifier = '/activerecord-is-reinventing-sequel';
    var disqus_url = 'https://janko.io/activerecord-is-reinventing-sequel/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div>

      </main>
    </div>

    
      <!-- Fathom - beautiful, simple website analytics -->
<script src="https://bouncy-van.janko.io/script.js" data-site="EKJCVCTX" defer></script>
<!-- / Fathom -->

    
  </body>
</html>
